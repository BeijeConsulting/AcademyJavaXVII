
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bookings Recap</title>

<link href="./static/main_style.css" rel="stylesheet" type="text/css">
<link href="./static/recap_booking.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./static/main_functions.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com%22%3E/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
<link
	href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Lumanosimo&display=swap"
	rel="stylesheet">
<link
	href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
	rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
	rel="stylesheet">
<script src="./static/recap_booking.js" type="text/javascript"></script>

</head>

<body>

	<div class="header">
        <div class="logo"><a href="./home.html" id="logo"><b>Beije Travels</b></a></div>
        <div class="topnav" id="menu">

        </div>

    </div>

    <div class="container">
        <div class="card-container extra-large">
            <a href="./passengers_data.html"><button class="secondary-button f-left">Back</button></a>
            <br><br><br>

            <div class="" style="display: flex">
                <!-- BOOKINGS-->
                <div id="bookings_div" class="card large">
                    <h2>Booking Recap</h2>
                    <hr/>

                </div>
                <!-- PASSENGERS-->
                <div >
                    <div id="passengers_div" style="display:table-caption" class="card large">
                        <h2>Passengers</h2>
                        <hr/>
                        <div id="list_of_passengers" class="card less-shadow">
                        </div>


                    </div>
                    <div class="card large" style="display: inline-block">
                        <h3 id="amount" style="float:left"></h3>
                        <div class="button-right-container" style="padding-top: 0.9em">
                            <a><button class="secondary-button" onclick="redirect()">Buy</button></a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
	<script>
		generateMenu();

		//BOOKINGS
		let bookingsDiv = document.getElementById("bookings_div");
		let bookingsJson = localStorage.getItem("bookings");
		let bookings = [];
		bookings = JSON.parse(bookingsJson);
		
		let newDiv;
		let topDiv;
		let middleDiv;
		let bottomDiv;
		let leftDiv;
		let rightDiv;
		
		let totalAmount = 0;
		let departure_city = localStorage.getItem("departure_city");
		let arrival_city = localStorage.getItem("arrival_city");
		let dateTime;
		
		for (let i = 0; i < bookings.length; i++){
			newDiv = document.createElement("div");
			newDiv.id = "booking-" + i;
			newDiv.className = "card less-shadow";
			bookingsDiv.appendChild(newDiv);
			console.log("bookings", i);
			console.log(bookings[i]);
			
			//TOP DIV
			topDiv = document.createElement("div");
			topDiv.id = "top_div-" + i;
			topDiv.className = "middleman";
			newDiv.appendChild(topDiv);
			
			leftDiv = document.createElement("div");
			leftDiv.id = "departure_xport_div-" + i;
			leftDiv.className = "xport_div";
			leftDiv.innerHTML = "<span class=\"city-font\">" + departure_city + "</span><br><span class=\"xport-font\">" + bookings[i].departureXport.name + "</span>";
			topDiv.appendChild(leftDiv);
			
			rightDiv = document.createElement("div");
			leftDiv.id = "departure_time_div-" + i;
			rightDiv.className = "time_div";
			
			dateTime = bookings[i].departure_date.split("T");
			rightDiv.innerHTML = "<span class=\"city-font\">" + dateTime[1].substring(0,5) + "</span><br><span class=\"xport-font\">" + dateTime[0] + "</span>";
			topDiv.appendChild(rightDiv);
			
			//MIDDLE DIV
			middleDiv = document.createElement("div");
			middleDiv.id = "middle_div-" + i;
			middleDiv.className = "middleman";
			newDiv.appendChild(middleDiv);
			
			leftDiv = document.createElement("div");
			leftDiv.id = "arrow_div-" + i;
			leftDiv.className = "plane_div";
			leftDiv.innerHTML = "<i class=\"material-icons plane\">flight</i>"
			//leftDiv.innerHTML = "<span class=\"material-symbols-outlined arrow\">arrow_downward</span>";
			middleDiv.appendChild(leftDiv);
			// Crea due oggetti Date
			const inizio = new Date(bookings[i].departure_date); // Sostituisci con la tua data e ora di inizio
			const fine = new Date(bookings[i].arrival_date);   // Sostituisci con la tua data e ora di fine

			// Calcola la differenza tra le due date in millisecondi
			const differenzaInMillisecondi = fine - inizio;

			// Calcola la durata in ore
			const durataInOre = differenzaInMillisecondi / (1000 * 60 * 60); // 1 ora = 3600000 millisecondi
			let durataInMinuti = differenzaInMillisecondi / (1000 * 60);
			durataInMinuti = durataInMinuti % 60;
			rightDiv = document.createElement("div");
			leftDiv.id = "duration_div-" + i;
			rightDiv.className = "duration_div";
			rightDiv.innerHTML = "<span class=\"duration-font\">" + durataInOre.toFixed(0) + " h " + durataInMinuti.toFixed(0) + " m" + "</span>";
			middleDiv.appendChild(rightDiv);
			
			//BOTTOM DIV
			bottomDiv = document.createElement("div");
			bottomDiv.id = "top_div-" + i;
			bottomDiv.className = "middleman";
			newDiv.appendChild(bottomDiv);
			
			leftDiv = document.createElement("div");
			leftDiv.id = "arrival_xport_div-" + i;
			leftDiv.className = "xport_div";
			leftDiv.innerHTML = "<span class=\"city-font\">" + arrival_city + "</span><br><span class=\"xport-font\">" + bookings[i].arrivalXport.name + "</span>";
			bottomDiv.appendChild(leftDiv);
		
			rightDiv = document.createElement("div");
			leftDiv.id = "arrival_time_div-" + i;
			rightDiv.className = "time_div";
			dateTime = bookings[i].arrival_date.split("T");
			rightDiv.innerHTML = "<span class=\"city-font\">" + dateTime[1].substring(0,5) + "</span><br><span class=\"xport-font\">" + dateTime[0] + "</span>";
			bottomDiv.appendChild(rightDiv);
			
			totalAmount +=  bookings[i].amount;
			let temp = departure_city;
			departure_city = arrival_city;
			arrival_city = temp;
		}
		
		document.getElementById("amount").innerHTML = "Total: " + totalAmount.toFixed(2) + " &euro;";
		localStorage.setItem("totalAmount", totalAmount.toFixed(2));
		localStorage.setItem("nTickets", bookings.length);
		
		//PASSENGERS
		let passengersJson = localStorage.getItem("passengers");
		let passengers = JSON.parse(passengersJson);
		//let passengersDiv = document.getElementById("passengers_div");
		let listOfPassengers = document.getElementById("list_of_passengers");
		let text ="";
		
		for (let i = 0; i < passengers.length; i++){
			text += "<p class=\"passenger-font\">" + passengers[i].name + " " + passengers[i].surname + "</p><hr>";
		}
		
		text += "<p class=\"passenger-font\"><b>Number of passengers:</b> " + passengers.length + "</p>";
		listOfPassengers.innerHTML = text;
		
		
	</script>

</body>
</html>